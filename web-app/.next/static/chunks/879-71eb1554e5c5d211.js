"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{462:function(e,t,a){a.d(t,{W:function(){return l},m:function(){return c}});var r=a(7437),i=a(2265);let o=(0,i.createContext)(void 0),n={flowState:"loading",currentTab:"dashboard",userRole:"employee",isAuthenticated:!1,hasCompletedOnboarding:!1};function s(e,t){switch(t.type){case"SET_FLOW_STATE":return{...e,flowState:t.payload};case"SET_CURRENT_TAB":return{...e,currentTab:t.payload};case"SET_USER_ROLE":return{...e,userRole:t.payload};case"SET_AUTHENTICATED":return{...e,isAuthenticated:t.payload};case"SET_ONBOARDING_COMPLETED":return{...e,hasCompletedOnboarding:t.payload};case"COMPLETE_ONBOARDING":return{...e,hasCompletedOnboarding:!0,flowState:"authentication"};case"AUTHENTICATE":return{...e,isAuthenticated:!0,flowState:"main"};case"LOGOUT":return{...e,isAuthenticated:!1,flowState:"authentication"};case"LOAD_PERSISTED_STATE":return{...e,...t.payload,flowState:"loading",isAuthenticated:t.payload.isAuthenticated||!1};default:return e}}function l(e){let{children:t}=e,[a,l]=(0,i.useReducer)(s,n);return(0,i.useEffect)(()=>{setTimeout(()=>{try{let e=localStorage.getItem("stream-app-state");if(e){let t=JSON.parse(e);l({type:"LOAD_PERSISTED_STATE",payload:t})}}catch(e){console.warn("Failed to load persisted app state:",e)}},100)},[]),(0,i.useEffect)(()=>{if("loading"!==a.flowState)try{let e={userRole:a.userRole,hasCompletedOnboarding:a.hasCompletedOnboarding,currentTab:a.currentTab,isAuthenticated:a.isAuthenticated};localStorage.setItem("stream-app-state",JSON.stringify(e))}catch(e){console.warn("Failed to persist app state:",e)}},[a]),(0,i.useEffect)(()=>{if("loading"===a.flowState){console.log("Stream App: Initializing flow state transition...",{hasCompletedOnboarding:a.hasCompletedOnboarding,isAuthenticated:a.isAuthenticated});let e=setTimeout(()=>{a.hasCompletedOnboarding?a.isAuthenticated?(console.log("Stream App: Transitioning to main app"),l({type:"SET_FLOW_STATE",payload:"main"})):(console.log("Stream App: Transitioning to authentication"),l({type:"SET_FLOW_STATE",payload:"authentication"})):(console.log("Stream App: Transitioning to onboarding"),l({type:"SET_FLOW_STATE",payload:"onboarding"}))},1500);return()=>clearTimeout(e)}},[a.flowState,a.hasCompletedOnboarding,a.isAuthenticated]),(0,r.jsx)(o.Provider,{value:{state:a,setFlowState:e=>l({type:"SET_FLOW_STATE",payload:e}),setCurrentTab:e=>l({type:"SET_CURRENT_TAB",payload:e}),setUserRole:e=>l({type:"SET_USER_ROLE",payload:e}),setAuthenticated:e=>l({type:"SET_AUTHENTICATED",payload:e}),setOnboardingCompleted:e=>l({type:"SET_ONBOARDING_COMPLETED",payload:e}),completeOnboarding:()=>l({type:"COMPLETE_ONBOARDING"}),authenticate:()=>l({type:"AUTHENTICATE"}),logout:()=>l({type:"LOGOUT"})},children:t})}function c(){let e=(0,i.useContext)(o);if(void 0===e)throw Error("useAppState must be used within an AppStateProvider");return e}},5098:function(e,t,a){a.d(t,{dt:function(){return p},$$:function(){return E},L8:function(){return h},ww:function(){return y}});var r=a(7437),i=a(2265),o=a(6886);class n{static getInstance(){return n.instance||(n.instance=new n),n.instance}async startWorkSession(e,t,a){let r={id:"session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),employeeId:e,startTime:new Date,hoursWorked:0,hourlyRate:t,isActive:!0,location:a,breaks:[]},i=this.workSessions.get(e)||[];return i.push(r),this.workSessions.set(e,i),await this.updateRealTimeEarnings(e),await this.addLedgerEntry({id:"ledger_".concat(Date.now()),employeeId:e,type:"work_session",amount:0,description:"Work session started",timestamp:new Date,sessionId:r.id,verified:!1}),r}async endWorkSession(e,t){let a=this.workSessions.get(e)||[],r=a.findIndex(e=>e.id===t&&e.isActive);if(-1===r)throw Error("Active work session not found");let i=a[r],o=new Date,n=o.getTime()-i.startTime.getTime(),s=6e4*i.breaks.reduce((e,t)=>e+t.duration,0);i.endTime=o,i.hoursWorked=Math.max(0,n-s)/36e5,i.isActive=!1,a[r]=i,this.workSessions.set(e,a);let l=this.calculateSessionEarnings(i);return await this.updateRealTimeEarnings(e),await this.addLedgerEntry({id:"ledger_".concat(Date.now()),employeeId:e,type:"work_session",amount:l.grossPay,description:"Work session completed - ".concat(i.hoursWorked.toFixed(2)," hours"),timestamp:o,sessionId:i.id,verified:!1}),await this.generateSessionProof(i),i}async addBreak(e,t,a,r){let i=this.workSessions.get(e)||[],o=i.find(e=>e.id===t);if(!o)throw Error("Work session not found");let n=Math.max(0,(r.getTime()-a.getTime())/6e4);o.breaks.push({start:a,end:r,duration:n}),this.workSessions.set(e,i),await this.updateRealTimeEarnings(e)}calculateSessionEarnings(e){let t=Math.min(e.hoursWorked,this.settings.overtimeThreshold),a=Math.max(0,e.hoursWorked-this.settings.overtimeThreshold);return{grossPay:t*e.hourlyRate+a*e.hourlyRate*this.settings.overtimeMultiplier,regularHours:t,overtimeHours:a}}async updateRealTimeEarnings(e){let t=this.workSessions.get(e)||[],a=t.find(e=>e.isActive),r=0,i=0;if(t.filter(e=>!e.isActive).forEach(e=>{r+=e.hoursWorked;let t=this.calculateSessionEarnings(e);i+=t.grossPay}),a){let e=Math.max(0,(new Date().getTime()-a.startTime.getTime())/36e5-a.breaks.reduce((e,t)=>e+t.duration,0)/60);r+=e;let t=this.calculateSessionEarnings({...a,hoursWorked:e});i+=t.grossPay}let o=i*(this.settings.taxRate+this.settings.socialSecurityRate+this.settings.medicareRate),n=i-o,s=r*((null==a?void 0:a.hourlyRate)||0),l=5*s,c={employeeId:e,currentSessionId:null==a?void 0:a.id,accumulatedHours:r,estimatedGrossPay:i,estimatedNetPay:n,availableForWithdrawal:.8*n,lastUpdated:new Date,projectedDailyEarnings:s,projectedWeeklyEarnings:l,projectedMonthlyEarnings:4.33*l};this.realTimeEarnings.set(e,c),this.notifyEarningsUpdate(e,c)}getRealTimeEarnings(e){return this.realTimeEarnings.get(e)||null}subscribeToEarningsUpdates(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{let a=this.listeners.get(e);a&&(a.delete(t),0===a.size&&this.listeners.delete(e))}}notifyEarningsUpdate(e,t){let a=this.listeners.get(e);a&&a.forEach(e=>e(t))}async processWithdrawal(e,t){let a=this.realTimeEarnings.get(e);if(!a)throw Error("No earnings data found for employee");if(t<this.settings.minimumWithdrawal)throw Error("Minimum withdrawal amount is $".concat(this.settings.minimumWithdrawal));if(t>a.availableForWithdrawal)throw Error("Insufficient available balance for withdrawal");let r=t*this.settings.withdrawalFeePercentage,i="withdrawal_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9));return await this.addLedgerEntry({id:"ledger_".concat(Date.now()),employeeId:e,type:"withdrawal",amount:-t,description:"Instant withdrawal - $".concat((t-r).toFixed(2)," (fee: $").concat(r.toFixed(2),")"),timestamp:new Date,verified:!1}),a.availableForWithdrawal-=t,this.realTimeEarnings.set(e,a),this.notifyEarningsUpdate(e,a),i}async generateSessionProof(e){try{let t={salary:e.hoursWorked*e.hourlyRate,hoursWorked:e.hoursWorked,hourlyRate:e.hourlyRate,periodStart:e.startTime,periodEnd:e.endTime||new Date,employeeId:e.employeeId,employerAttestation:"employer_verified"};await o.$.generateWorkHoursProof(t);let a=this.ledgerEntries.find(t=>t.sessionId===e.id&&"work_session"===t.type);a&&(a.verified=!0)}catch(e){console.error("Failed to generate session proof:",e)}}async addLedgerEntry(e){this.ledgerEntries.push(e)}getLedgerEntries(e){return this.ledgerEntries.filter(t=>t.employeeId===e)}getCurrentSession(e){return(this.workSessions.get(e)||[]).find(e=>e.isActive)||null}getAllSessions(e){return this.workSessions.get(e)||[]}updateSettings(e){this.settings={...this.settings,...e},Array.from(this.realTimeEarnings.keys()).forEach(e=>{this.updateRealTimeEarnings(e)})}getSettings(){return{...this.settings}}startRealTimeUpdates(e){let t=setInterval(async()=>{this.getCurrentSession(e)&&await this.updateRealTimeEarnings(e)},1e3);this["interval_".concat(e)]=t}stopRealTimeUpdates(e){let t=this["interval_".concat(e)];t&&(clearInterval(t),delete this["interval_".concat(e)])}async verifyLedgerIntegrity(){return!0}constructor(){this.workSessions=new Map,this.realTimeEarnings=new Map,this.payrollEntries=new Map,this.ledgerEntries=[],this.settings={overtimeThreshold:40,overtimeMultiplier:1.5,taxRate:.22,socialSecurityRate:.062,medicareRate:.0145,withdrawalFeePercentage:.01,minimumWithdrawal:10,currency:"USD"},this.listeners=new Map}}let s=n.getInstance();var l=a(462);let c=(0,i.createContext)(void 0),d={currentSession:null,realTimeEarnings:null,sessions:[],ledgerEntries:[],isSessionActive:!1,sessionStartTime:null,elapsedTime:0,isLoading:!1,error:null,settings:s.getSettings()};function u(e,t){switch(t.type){case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_ERROR":return{...e,error:t.payload};case"SET_CURRENT_SESSION":var a;return{...e,currentSession:t.payload,isSessionActive:(null===(a=t.payload)||void 0===a?void 0:a.isActive)||!1};case"SET_REAL_TIME_EARNINGS":return{...e,realTimeEarnings:t.payload};case"SET_SESSIONS":return{...e,sessions:t.payload};case"SET_LEDGER_ENTRIES":return{...e,ledgerEntries:t.payload};case"UPDATE_ELAPSED_TIME":return{...e,elapsedTime:t.payload};case"SET_SETTINGS":return{...e,settings:t.payload};case"SESSION_STARTED":return{...e,currentSession:t.payload.session,isSessionActive:!0,sessionStartTime:t.payload.startTime,elapsedTime:0};case"SESSION_ENDED":return{...e,currentSession:null,isSessionActive:!1,sessionStartTime:null,elapsedTime:0};default:return e}}function p(e){let{children:t}=e,[a,o]=(0,i.useReducer)(u,d),{state:n}=(0,l.m)(),p="employee"===n.userRole?"current_user":"";(0,i.useEffect)(()=>{let e=null;return a.isSessionActive&&a.sessionStartTime&&(e=setInterval(()=>{o({type:"UPDATE_ELAPSED_TIME",payload:Math.floor((new Date().getTime()-a.sessionStartTime.getTime())/1e3)})},1e3)),()=>{e&&clearInterval(e)}},[a.isSessionActive,a.sessionStartTime]),(0,i.useEffect)(()=>{if(!p)return;let e=s.subscribeToEarningsUpdates(p,e=>{o({type:"SET_REAL_TIME_EARNINGS",payload:e})});return s.startRealTimeUpdates(p),()=>{e(),s.stopRealTimeUpdates(p)}},[p]),(0,i.useEffect)(()=>{p&&S()},[p]);let h=(0,i.useCallback)(async(e,t)=>{if(!p)throw Error("Employee ID not available");o({type:"SET_LOADING",payload:!0}),o({type:"SET_ERROR",payload:null});try{let a=await s.startWorkSession(p,e,t);o({type:"SESSION_STARTED",payload:{session:a,startTime:a.startTime}}),await S()}catch(e){throw o({type:"SET_ERROR",payload:e.message||"Failed to start work session"}),e}finally{o({type:"SET_LOADING",payload:!1})}},[p]),y=(0,i.useCallback)(async()=>{if(!p||!a.currentSession)throw Error("No active work session");o({type:"SET_LOADING",payload:!0}),o({type:"SET_ERROR",payload:null});try{await s.endWorkSession(p,a.currentSession.id),o({type:"SESSION_ENDED"}),await S()}catch(e){throw o({type:"SET_ERROR",payload:e.message||"Failed to end work session"}),e}finally{o({type:"SET_LOADING",payload:!1})}},[p,a.currentSession]),E=(0,i.useCallback)(async(e,t)=>{if(!p||!a.currentSession)throw Error("No active work session");o({type:"SET_ERROR",payload:null});try{await s.addBreak(p,a.currentSession.id,e,t);let r=s.getCurrentSession(p);o({type:"SET_CURRENT_SESSION",payload:r})}catch(e){throw o({type:"SET_ERROR",payload:e.message||"Failed to add break"}),e}},[p,a.currentSession]),m=(0,i.useCallback)(async e=>{if(!p)throw Error("Employee ID not available");o({type:"SET_LOADING",payload:!0}),o({type:"SET_ERROR",payload:null});try{let t=await s.processWithdrawal(p,e);return await S(),t}catch(e){throw o({type:"SET_ERROR",payload:e.message||"Withdrawal failed"}),e}finally{o({type:"SET_LOADING",payload:!1})}},[p]),f=(0,i.useCallback)(e=>{s.updateSettings(e),o({type:"SET_SETTINGS",payload:s.getSettings()})},[]),S=(0,i.useCallback)(async()=>{if(p){o({type:"SET_LOADING",payload:!0});try{let e=s.getCurrentSession(p);o({type:"SET_CURRENT_SESSION",payload:e});let t=s.getAllSessions(p);o({type:"SET_SESSIONS",payload:t});let a=s.getRealTimeEarnings(p);o({type:"SET_REAL_TIME_EARNINGS",payload:a});let r=s.getLedgerEntries(p);o({type:"SET_LEDGER_ENTRIES",payload:r});let i=s.getSettings();o({type:"SET_SETTINGS",payload:i})}catch(e){o({type:"SET_ERROR",payload:e.message||"Failed to refresh data"})}finally{o({type:"SET_LOADING",payload:!1})}}},[p]),g=(0,i.useCallback)(()=>{o({type:"SET_ERROR",payload:null})},[]);return(0,r.jsx)(c.Provider,{value:{state:a,startWorkSession:h,endWorkSession:y,addBreak:E,processWithdrawal:m,updateSettings:f,refreshData:S,clearError:g},children:t})}function h(){let e=(0,i.useContext)(c);if(void 0===e)throw Error("usePayroll must be used within a PayrollProvider");return e}function y(){let{state:e}=h();return e.realTimeEarnings}function E(){let{state:e}=h();return{session:e.currentSession,isActive:e.isSessionActive,elapsedTime:e.elapsedTime,startTime:e.sessionStartTime}}},5384:function(e,t,a){a.d(t,{O:function(){return u},n:function(){return d}});var r=a(7437),i=a(2265),o=a(1662);let n=(0,i.createContext)(void 0),s=[{chainId:1,name:"Ethereum Mainnet",rpcUrl:"https://mainnet.infura.io/v3/YOUR_KEY",symbol:"ETH"},{chainId:137,name:"Polygon Mainnet",rpcUrl:"https://polygon-rpc.com",symbol:"MATIC"},{chainId:11155111,name:"Sepolia Testnet",rpcUrl:"https://sepolia.infura.io/v3/YOUR_KEY",symbol:"SEP"},{chainId:31337,name:"Hardhat Local",rpcUrl:"http://localhost:8545",symbol:"ETH"}],l={connectedWallet:null,connectionStatus:"disconnected",supportedChains:s,balance:"0",isConnecting:!1,error:null};function c(e,t){switch(t.type){case"SET_CONNECTING":return{...e,isConnecting:t.payload,error:t.payload?null:e.error};case"SET_CONNECTED":return{...e,connectedWallet:t.payload,connectionStatus:"connected",isConnecting:!1,error:null};case"SET_DISCONNECTED":return{...e,connectedWallet:null,connectionStatus:"disconnected",isConnecting:!1,balance:"0",error:null};case"SET_CONNECTION_STATUS":return{...e,connectionStatus:t.payload};case"SET_BALANCE":return{...e,balance:t.payload};case"SET_ERROR":return{...e,error:t.payload,isConnecting:!1,connectionStatus:t.payload?"error":e.connectionStatus};case"SET_SUPPORTED_CHAINS":return{...e,supportedChains:t.payload};default:return e}}function d(e){let{children:t}=e,[a,d]=(0,i.useReducer)(c,l);(0,i.useEffect)(()=>{u()},[]),(0,i.useEffect)(()=>{if(window.ethereum){let e=window.ethereum,t=e=>{0===e.length?d({type:"SET_DISCONNECTED"}):a.connectedWallet&&e[0]!==a.connectedWallet.address&&p()},r=e=>{window.location.reload()},i=()=>{d({type:"SET_DISCONNECTED"})};return e.on("accountsChanged",t),e.on("chainChanged",r),e.on("disconnect",i),()=>{e.removeListener("accountsChanged",t),e.removeListener("chainChanged",r),e.removeListener("disconnect",i)}}},[a.connectedWallet]);let u=async()=>{try{if(window.ethereum){let e=await window.ethereum.request({method:"eth_accounts"});if(e.length>0){let t=await window.ethereum.request({method:"eth_chainId"}),a={address:e[0],chainId:parseInt(t,16),isConnected:!0};d({type:"SET_CONNECTED",payload:a}),await E(e[0])}}}catch(e){console.error("Error checking wallet connection:",e)}},p=(0,i.useCallback)(async()=>{if(!window.ethereum){d({type:"SET_ERROR",payload:"MetaMask is not installed. Please install MetaMask to continue."});return}d({type:"SET_CONNECTING",payload:!0});try{let e=await window.ethereum.request({method:"eth_requestAccounts"});if(0===e.length)throw Error("No accounts found");let t=await window.ethereum.request({method:"eth_chainId"}),a={address:e[0],chainId:parseInt(t,16),isConnected:!0};d({type:"SET_CONNECTED",payload:a}),await E(e[0])}catch(t){let e="Failed to connect wallet";4001===t.code?e="Connection rejected by user":-32002===t.code&&(e="Connection request pending. Please check MetaMask."),d({type:"SET_ERROR",payload:e}),console.error("Wallet connection error:",t)}},[]),h=(0,i.useCallback)(()=>{d({type:"SET_DISCONNECTED"}),localStorage.removeItem("stream-wallet-connection")},[]),y=(0,i.useCallback)(async e=>{if(!window.ethereum)throw Error("MetaMask is not available");try{await window.ethereum.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x".concat(e.toString(16))}]})}catch(t){if(4902===t.code){let t=s.find(t=>t.chainId===e);t&&await window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0x".concat(e.toString(16)),chainName:t.name,rpcUrls:[t.rpcUrl],nativeCurrency:{name:t.symbol,symbol:t.symbol,decimals:18}}]})}else throw t}},[]),E=async e=>{try{if(window.ethereum){let t=await window.ethereum.request({method:"eth_getBalance",params:[e,"latest"]}),a=o.dF(t);d({type:"SET_BALANCE",payload:a})}}catch(e){console.error("Error getting balance:",e)}},m=(0,i.useCallback)(async()=>{if(!a.connectedWallet)throw Error("Wallet not connected");return await E(a.connectedWallet.address),a.balance},[a.connectedWallet,a.balance]),f=(0,i.useCallback)(async e=>{if(!window.ethereum||!a.connectedWallet)throw Error("Wallet not connected");try{return await window.ethereum.request({method:"personal_sign",params:[e,a.connectedWallet.address]})}catch(e){throw console.error("Error signing message:",e),e}},[a.connectedWallet]),S=(0,i.useCallback)(async(e,t)=>{if(!window.ethereum||!a.connectedWallet)throw Error("Wallet not connected");try{return await window.ethereum.request({method:"eth_sendTransaction",params:[{from:a.connectedWallet.address,to:e,value:o.fi(t).toString(16)}]})}catch(e){throw console.error("Error sending transaction:",e),e}},[a.connectedWallet]);return(0,r.jsx)(n.Provider,{value:{state:a,connectWallet:p,disconnectWallet:h,switchNetwork:y,getBalance:m,signMessage:f,sendTransaction:S},children:t})}function u(){let e=(0,i.useContext)(n);if(void 0===e)throw Error("useWallet must be used within a WalletProvider");return e}},7187:function(e,t,a){a.d(t,{W:function(){return u},l:function(){return d}});var r=a(7437),i=a(2265),o=a(6886),n=a(5384);let s=(0,i.createContext)(void 0),l={activeProofs:[],completedProofs:[],proofStats:{totalGenerated:0,successRate:100,averageTime:0,byStatus:{generating:0,completed:0,failed:0,verifying:0}},isGenerating:!1,generationProgress:0,currentProofId:null,error:null};function c(e,t){switch(t.type){case"START_GENERATION":return{...e,isGenerating:!0,generationProgress:0,currentProofId:t.payload.proofId,error:null};case"UPDATE_PROGRESS":return{...e,generationProgress:t.payload};case"GENERATION_SUCCESS":{let a=t.payload,r=e.activeProofs.filter(e=>e.id!==a.id),i=[...e.completedProofs,a];return{...e,activeProofs:r,completedProofs:i,isGenerating:!1,generationProgress:100,currentProofId:null}}case"GENERATION_FAILED":{let{proofId:a,error:r}=t.payload,i=e.activeProofs.map(e=>e.id===a?{...e,status:"failed"}:e);return{...e,activeProofs:i,isGenerating:!1,generationProgress:0,currentProofId:null,error:r}}case"UPDATE_PROOF_STATUS":{let{id:a,status:r}=t.payload,i=e=>e.map(e=>e.id===a?{...e,status:r}:e);return{...e,activeProofs:i(e.activeProofs),completedProofs:i(e.completedProofs)}}case"SET_ERROR":return{...e,error:t.payload};case"LOAD_PROOFS":let a=t.payload,r=a.filter(e=>"generating"===e.status||"verifying"===e.status),i=a.filter(e=>"completed"===e.status||"failed"===e.status);return{...e,activeProofs:r,completedProofs:i};case"UPDATE_STATS":return{...e,proofStats:t.payload};default:return e}}function d(e){let{children:t}=e,[a,d]=(0,i.useReducer)(c,l),{state:u}=(0,n.O)(),[p,h]=i.useState(!1);(0,i.useEffect)(()=>{(async()=>{try{h("undefined"!=typeof WebAssembly&&"function"==typeof WebAssembly.instantiate),await o.$.initialize(),await o.$.preloadCircuits()}catch(e){console.error("Failed to initialize ZK-proof service:",e),h(!1)}})()},[]);let y=(0,i.useCallback)(async e=>{if(!p)throw Error("WebAssembly not supported in this browser");let t="proof_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),a={id:t,title:"Salary Proof",subtitle:"".concat(e.hoursWorked,"h @ $").concat(e.hourlyRate,"/hr"),amount:e.wageAmount,status:"generating",progress:0,createdAt:new Date,proofType:"wage_proof",generationTime:0,circuitVersion:"v1.0.0",circuitId:"salary_v1",publicSignalsCount:4};d({type:"START_GENERATION",payload:{proofId:t}});try{let t=Date.now();d({type:"UPDATE_PROGRESS",payload:10});let r={salary:e.wageAmount,hoursWorked:e.hoursWorked,hourlyRate:e.hourlyRate,periodStart:new Date(e.timestamp.getTime()-6048e5),periodEnd:e.timestamp,employeeId:e.nullifier,employerAttestation:"employer_signature_placeholder"};d({type:"UPDATE_PROGRESS",payload:30});let i=await o.$.generateSalaryProof(r);d({type:"UPDATE_PROGRESS",payload:80});let n=(Date.now()-t)/1e3,s={proof:{pi_a:i.proof.pi_a,pi_b:i.proof.pi_b,pi_c:i.proof.pi_c,protocol:"groth16",curve:"bn254"},publicSignals:i.publicSignals,metadata:{circuitId:"salary_v1",provingTime:n,verificationKey:JSON.stringify(i.verificationKey),publicInputs:{wageAmount:String(Math.floor(1e18*e.wageAmount)),nullifierHash:e.nullifier}}};d({type:"UPDATE_PROGRESS",payload:100});let l={...a,status:"completed",progress:100,generationTime:n};return d({type:"GENERATION_SUCCESS",payload:l}),s}catch(e){throw d({type:"GENERATION_FAILED",payload:{proofId:t,error:e.message||"Proof generation failed"}}),e}},[p]),E=(0,i.useCallback)(async e=>{if(!p)throw Error("WebAssembly not supported in this browser");try{return await o.$.generateSalaryProof(e)}catch(e){throw d({type:"SET_ERROR",payload:e.message}),e}},[p]),m=(0,i.useCallback)(async e=>{if(!p)throw Error("WebAssembly not supported in this browser");try{return await o.$.generateWorkHoursProof(e)}catch(e){throw d({type:"SET_ERROR",payload:e.message}),e}},[p]),f=(0,i.useCallback)(async e=>{if(!p)throw Error("WebAssembly not supported in this browser");try{return await o.$.generateEmploymentProof(e)}catch(e){throw d({type:"SET_ERROR",payload:e.message}),e}},[p]),S=(0,i.useCallback)(async(e,t)=>{if("connected"!==u.connectionStatus||!u.connectedWallet)throw Error("Wallet not connected");try{return await o.$.submitProofToBlockchain(e,t,null)}catch(e){throw d({type:"SET_ERROR",payload:e.message}),e}},[u.connectionStatus,u.connectedWallet]),g=(0,i.useCallback)(async e=>{if(!p)return console.warn("WebAssembly not supported, skipping verification"),!1;try{let t={pi_a:e.proof.pi_a,pi_b:e.proof.pi_b,pi_c:e.proof.pi_c},a="salary";return e.metadata.circuitId.includes("work_hours")?a="workHours":e.metadata.circuitId.includes("employment")&&(a="employment"),await o.$.verifyProof(a,t,e.publicSignals)}catch(e){return console.error("Proof verification failed:",e),!1}},[p]),w=(0,i.useCallback)(e=>[...a.activeProofs,...a.completedProofs].find(t=>t.id===e)||null,[a.activeProofs,a.completedProofs]),T=(0,i.useCallback)((e,t)=>{d({type:"UPDATE_PROOF_STATUS",payload:{id:e,status:t}})},[]),_=(0,i.useCallback)(()=>{d({type:"SET_ERROR",payload:null})},[]);return(0,r.jsx)(s.Provider,{value:{state:a,generateProof:y,generateSalaryProof:E,generateWorkHoursProof:m,generateEmploymentProof:f,verifyProof:g,submitProofToBlockchain:S,getProofById:w,updateProofStatus:T,clearError:_,isZKSupported:p},children:t})}function u(){let e=(0,i.useContext)(s);if(void 0===e)throw Error("useZKProof must be used within a ZKProofProvider");return e}},6886:function(e,t,a){a.d(t,{$:function(){return l}});var r=a(9409),i=a(5474),o=a(3696),n=a(9478);class s{async initialize(){if(!this.isInitialized)try{let e=await Promise.all([a.e(995),a.e(968),a.e(566)]).then(a.bind(a,9445));this.snarkjs=e.default||e,this.isInitialized=!0}catch(e){throw console.error("Failed to initialize ZK proof service:",e),Error("ZK proof service initialization failed")}}async generateSalaryProof(e){await this.initialize();try{let t=this.prepareSalaryCircuitInput(e),{proof:a,publicSignals:r}=await this.snarkjs.groth16.fullProve(t,this.circuits.salary.wasmPath,this.circuits.salary.zkeyPath),i=await this.loadVerificationKey("salary"),o=this.generateProofHash(a,r);return{proof:{pi_a:[a.pi_a[0],a.pi_a[1]],pi_b:[[a.pi_b[0][1],a.pi_b[0][0]],[a.pi_b[1][1],a.pi_b[1][0]]],pi_c:[a.pi_c[0],a.pi_c[1]]},publicSignals:r,verificationKey:i,proofHash:o}}catch(e){throw console.error("Failed to generate salary proof:",e),Error("Salary proof generation failed")}}async generateWorkHoursProof(e){await this.initialize();try{let t=this.prepareWorkHoursCircuitInput(e),{proof:a,publicSignals:r}=await this.snarkjs.groth16.fullProve(t,this.circuits.workHours.wasmPath,this.circuits.workHours.zkeyPath),i=await this.loadVerificationKey("workHours"),o=this.generateProofHash(a,r);return{proof:{pi_a:[a.pi_a[0],a.pi_a[1]],pi_b:[[a.pi_b[0][1],a.pi_b[0][0]],[a.pi_b[1][1],a.pi_b[1][0]]],pi_c:[a.pi_c[0],a.pi_c[1]]},publicSignals:r,verificationKey:i,proofHash:o}}catch(e){throw console.error("Failed to generate work hours proof:",e),Error("Work hours proof generation failed")}}async generateEmploymentProof(e){await this.initialize();try{let t=this.prepareEmploymentCircuitInput(e),{proof:a,publicSignals:r}=await this.snarkjs.groth16.fullProve(t,this.circuits.employment.wasmPath,this.circuits.employment.zkeyPath),i=await this.loadVerificationKey("employment"),o=this.generateProofHash(a,r);return{proof:{pi_a:[a.pi_a[0],a.pi_a[1]],pi_b:[[a.pi_b[0][1],a.pi_b[0][0]],[a.pi_b[1][1],a.pi_b[1][0]]],pi_c:[a.pi_c[0],a.pi_c[1]]},publicSignals:r,verificationKey:i,proofHash:o}}catch(e){throw console.error("Failed to generate employment proof:",e),Error("Employment proof generation failed")}}async verifyProof(e,t,a){await this.initialize();try{let r=await this.loadVerificationKey(e);return await this.snarkjs.groth16.verify(r,a,t)}catch(e){return console.error("Failed to verify proof:",e),!1}}async submitProofToBlockchain(e,t,a){try{if(!a)throw Error("Signer not available");let o=new r.CH(t,["function submitProof(uint256[2] calldata _pA, uint256[2][2] calldata _pB, uint256[2] calldata _pC, uint256[] calldata _publicSignals) external returns (bool)"],a),n=[(0,i.yT)(e.proof.pi_a[0]),(0,i.yT)(e.proof.pi_a[1])],s=[[(0,i.yT)(e.proof.pi_b[0][0]),(0,i.yT)(e.proof.pi_b[0][1])],[(0,i.yT)(e.proof.pi_b[1][0]),(0,i.yT)(e.proof.pi_b[1][1])]],l=[(0,i.yT)(e.proof.pi_c[0]),(0,i.yT)(e.proof.pi_c[1])],c=e.publicSignals.map(e=>(0,i.yT)(e)),d=await o.submitProof(n,s,l,c);return await d.wait(),d.hash}catch(e){throw console.error("Failed to submit proof to blockchain:",e),Error("Blockchain proof submission failed")}}prepareSalaryCircuitInput(e){return{salary:e.salary.toString(),hoursWorked:e.hoursWorked.toString(),hourlyRate:Math.floor(100*e.hourlyRate).toString(),periodStart:Math.floor(e.periodStart.getTime()/1e3).toString(),periodEnd:Math.floor(e.periodEnd.getTime()/1e3).toString(),employeeId:this.hashToFieldElement(e.employeeId),employerAttestation:this.hashToFieldElement(e.employerAttestation)}}prepareWorkHoursCircuitInput(e){return{hoursWorked:e.hoursWorked.toString(),periodStart:Math.floor(e.periodStart.getTime()/1e3).toString(),periodEnd:Math.floor(e.periodEnd.getTime()/1e3).toString(),employeeId:this.hashToFieldElement(e.employeeId),minimumHours:"40",employerAttestation:this.hashToFieldElement(e.employerAttestation)}}prepareEmploymentCircuitInput(e){return{employeeId:this.hashToFieldElement(e.employeeId),employerAttestation:this.hashToFieldElement(e.employerAttestation),startDate:Math.floor(e.periodStart.getTime()/1e3).toString(),isActive:"1"}}async loadVerificationKey(e){try{let t=await fetch(this.circuits[e].verificationKeyPath);return await t.json()}catch(t){throw console.error("Failed to load verification key for ".concat(e,":"),t),Error("Verification key loading failed for ".concat(e))}}generateProofHash(e,t){let a=JSON.stringify({proof:e,publicSignals:t});return(0,o.w)((0,n.Y0)(a))}hashToFieldElement(e){let t=(0,o.w)((0,n.Y0)(e));return((0,i.yT)(t)%BigInt("21888242871839275222246405745257275088548364400416034343698204186575808495617")).toString()}static isWebAssemblySupported(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){let e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e) instanceof WebAssembly.Instance}}catch(e){}return!1}getCircuitInfo(e){return this.circuits[e]}async preloadCircuits(){await this.initialize();let e=Object.keys(this.circuits);await Promise.all(e.map(async e=>{try{await this.loadVerificationKey(e),console.log("Preloaded verification key for ".concat(e))}catch(t){console.warn("Failed to preload verification key for ".concat(e,":"),t)}}))}constructor(){this.circuits={salary:{wasmPath:"/circuits/salary.wasm",zkeyPath:"/circuits/salary_final.zkey",verificationKeyPath:"/circuits/salary_verification_key.json"},workHours:{wasmPath:"/circuits/work_hours.wasm",zkeyPath:"/circuits/work_hours_final.zkey",verificationKeyPath:"/circuits/work_hours_verification_key.json"},employment:{wasmPath:"/circuits/employment.wasm",zkeyPath:"/circuits/employment_final.zkey",verificationKeyPath:"/circuits/employment_verification_key.json"}},this.snarkjs=null,this.isInitialized=!1}}let l=new s}}]);